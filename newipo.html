<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>IPO Details</title>
    <link href="https://unpkg.com/tailwindcss@^1.0/dist/tailwind.min.css" rel="stylesheet" />
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Basic styling */
        .tabs {
        }

        .tab-titles {
            display: flex;
            justify-content: space-around;
            margin-bottom: 10px;
            position: relative;
        }

        .tab-container {
            position: relative; /* Position relative for the indicator */
            display: flex; /* Align tabs in a row */
        }

        .tab {
            text-align: center;
            cursor: pointer;
            color: rgb(31, 87, 209);
            padding: 15px;
            transition: color 0.3s ease-in-out; /* Smooth color transition */
        }

        .active-tab {
            border-bottom: 2px solid rgb(31, 87, 209);
            transition: left 2s ease-in-out;
            font-weight: bold;
        }

        .indicator {
            position: absolute;
            bottom: 0;
            left: 0; 
            height: 2px; 
            width: 100px; 
            background-color: rgb(4, 65, 197);
            transition: left 2s ease-in-out; 
        }

        input[type="radio"] {
            display: none;
        }

        .tab-content .content {
            display: none;
        }

        #tab1:checked ~ .tab-titles ~ .tab-content #content1,
        #tab2:checked ~ .tab-titles ~ .tab-content #content2 {
            display: block;
        }

        .tab-titles {
            position: relative;
            display: flex;
            margin-bottom: 10px;
        }

        .tab-titles:before {
    content: "";
    position: absolute;
    bottom: 0;
    left: 50%;
    width: 20%; 
    transform: translateX(-50%); /* Center the indicator *//* Default width for larger screens */
    height: 2px;
    background-color: rgb(4, 65, 197);
    transition: left 0.3s ease-in-out;
}

@media (max-width: 768px) { /* Adjust for medium devices */
    .tab-titles:before {
        left: 0;
        transform: translateX(-0%);
        width: 50%; /* Reduced width for medium devices */
    }
}

        #tab1:checked ~ .tab-titles:before {
            left: 0%;
        }

        #tab2:checked ~ .tab-titles:before {
            left: 50%;
        }

        .shimmer-effect {
            background: linear-gradient(
                90deg,
                #f0f0f0 25%,
                #e0e0e0 50%,
                #f0f0f0 75%
            );
            background-size: 400px 100%;
            animation: shimmer 1.5s infinite;
        }
    </style>
</head>

<body>
    <div class="md:hidden block bg-blue-600 relative h-[100px] max-w-4xl mx-auto">
        <div class="flex justify-center items-center text-center">
            <div class="w-screen">
                <div class="mx-auto my-4 mb-20 rounded-md text-white font-bold">
                    <nav class="absolute top-2 w-full">
                        <div class="grid grid-cols-12 my-4">
                            <div class="col-span-2 flex justify-start px-5 items-center">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="h-6 w-6">
                                    <path fill-rule="evenodd" d="M11.03 3.97a.75.75 0 0 1 0 1.06l-6.22 6.22H21a.75.75 0 0 1 0 1.5H4.81l6.22 6.22a.75.75 0 1 1-1.06 1.06l-7.5-7.5a.75.75 0 0 1 0-1.06l7.5-7.5a.75.75 0 0 1 1.06 0Z" clip-rule="evenodd" />
                                </svg>
                            </div>
                            <div class="col-span-8 flex justify-start items-center text-lg font-semibold">
                                IPO's
                            </div>
                            <div class="col-span-2 flex justify-end px-5   items-center">
                                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="h-6 w-6">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M9.879 7.519c1.171-1.025 3.071-1.025 4.242 0 1.172 1.025 1.172 2.687 0 3.712-.203.179-.43.326-.67.442-.745.361-1.45.999-1.45 1.827v.75M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9 5.25h.008v.008H12v-.008Z" />
                                </svg>
                            </div>
                        </div>
                    </nav>
                </div>
            </div>
        </div>
    </div>

    <div class="flex justify-center items-center absolute top-12 left-0 right-0">
        <div class="rounded-md border mt-5 bg-white shadow-lg w-full max-w-4xl md:max-w-none  min-h-screen">
            <div class="tabs px-3 py-3">
                <input type="radio" id="tab1" name="tab" checked />
                <input type="radio" id="tab2" name="tab" />

                <div class="tab-titles">
                    <label for="tab1" class="tab mx-4">Open & Upcoming</label>
                    <label for="tab2" class="tab mx-4 ml-5">Your Application</label>
                </div>

                <div class="tab-content">
                    <div class="bg-gray-100 h-2"></div>
                    <div class="content" id="content1">
                        <h2 class="text-lg font-bold pt-4">
                            Open IPO's
                            <span class="mx-2 inline-flex items-center rounded-full bg-red-500 px-1.5 py-0.5 text-xs font-medium text-white">9</span>
                        </h2>
                        <div class="mx-auto ">
                            <div class="my-2" id="shimmer">
                                <div class="bg-gray-50 rounded-md border border-gray-200 p-2 my-4">
                                    <div class="grid grid-cols-12">
                                        <div class="col-span-2">
                                            <div class="bg-gray-500 rounded-lg animate-pulse shimmer-effect my-2" style="width: 60px; height: 50px"></div>
                                        </div>
                                        <div class="col-span-8">
                                            <div class="bg-gray-500 rounded-lg animate-pulse shimmer-effect my-2" style="width: 100%; height: 10px"></div>
                                            <div class="bg-gray-200 rounded-lg animate-pulse shimmer-effect my-2" style="width: 50%; height: 10px"></div>
                                        </div>
                                    </div>
                                    <div class="">
                                        <div class="bg-gray-500 rounded-lg animate-pulse shimmer-effect my-2" style="width: 100%; height: 10px"></div>
                                        <div class="bg-gray-200 rounded-lg animate-pulse shimmer-effect my-2" style="width: 100%; height: 10px"></div>
                                    </div>
                                    <div class="bg-gray-200 rounded-lg animate-pulse shimmer-effect my-2" style="width: 100%; height: 60px"></div>
                                </div>
                                <div class="bg-gray-50 rounded-md border border-gray-200 p-2 my-4">
                                    <div class="grid grid-cols-12">
                                        <div class="col-span-2">
                                            <div class="bg-gray-500 rounded-lg animate-pulse shimmer-effect my-2" style="width: 60px; height: 50px"></div>
                                        </div>
                                        <div class="col-span-8">
                                            <div class="bg-gray-500 rounded-lg animate-pulse shimmer-effect my-2" style="width: 100%; height: 10px"></div>
                                            <div class="bg-gray-200 rounded-lg animate-pulse shimmer-effect my-2" style="width: 50%; height: 10px"></div>
                                        </div>
                                    </div>
                                    <div class="">
                                        <div class="bg-gray-500 rounded-lg animate-pulse shimmer-effect my-2" style="width: 100%; height: 10px"></div>
                                        <div class="bg-gray-200 rounded-lg animate-pulse shimmer-effect my-2" style="width: 100%; height: 10px"></div>
                                    </div>
                                    <div class="bg-gray-200 rounded-lg animate-pulse shimmer-effect my-2" style="width: 100%; height: 60px"></div>
                                </div>
                                <div class="bg-gray-50 rounded-md border border-gray-200 p-2 my-4">
                                    <div class="grid grid-cols-12">


                                        
                                         
                                        <div class="col-span-2">
                                            <div class="bg-gray-500 rounded-lg animate-pulse shimmer-effect my-2" style="width: 60px; height: 50px"></div>
                                        </div>
                                        <div class="col-span-8">
                                            <div class="bg-gray-500 rounded-lg animate-pulse shimmer-effect my-2" style="width: 100%; height: 10px"></div>
                                            <div class="bg-gray-200 rounded-lg animate-pulse shimmer-effect my-2" style="width: 50%; height: 10px"></div>
                                        </div>
                                    </div>
                                    <div class="">
                                        <div class="bg-gray-500 rounded-lg animate-pulse shimmer-effect my-2" style="width: 100%; height: 10px"></div>
                                        <div class="bg-gray-200 rounded-lg animate-pulse shimmer-effect my-2" style="width: 100%; height: 10px"></div>
                                    </div>
                                    <div class="bg-gray-200 rounded-lg animate-pulse shimmer-effect my-2" style="width: 100%; height: 60px"></div>
                                </div>
                            </div>
                            <div class="mx-auto my-2" id="no-shimmer" style="display: none">
                                <ul id="companiesContainer" role="list" class="mt-6 grid grid-cols-1 gap-x-6 w-full gap-y-8 lg:grid-cols-2 xl:gap-x-8">
                                </ul>
                            </div>
                        </div>
                    </div>
                    <div class="content" id="content2">
                        <div id="dashboard" class="tab-content">
                            <div class="content" id="content2">
                                <h2 class="text-lg font-bold pt-4">Your Applications</h2>
                                <div class="my-2" id="shimmerApplications">
                                    <div class="bg-gray-50 rounded-md border border-gray-200 p-2 my-4">
                                        <div class="grid grid-cols-12">
                                            <div class="col-span-2">
                                                <div class="bg-gray-500 rounded-lg animate-pulse shimmer-effect my-2" style="width: 60px; height: 50px"></div>
                                            </div>
                                            <div class="col-span-8">
                                                <div class="bg-gray-500 rounded-lg animate-pulse shimmer-effect my-2" style="width: 100%; height: 10px"></div>
                                                <div class="bg-gray-200 rounded-lg animate-pulse shimmer-effect my-2" style="width: 50%; height: 10px"></div>
                                            </div>
                                        </div>
                                        <div class="">
                                            <div class="bg-gray-500 rounded-lg animate-pulse shimmer-effect my-2" style="width: 100%; height: 10px"></div>
                                            <div class="bg-gray-200 rounded-lg animate-pulse shimmer-effect my-2" style="width: 100%; height: 10px"></div>
                                        </div>
                                        <div class="bg-gray-200 rounded-lg animate-pulse shimmer-effect my-2" style="width: 100%; height: 60px"></div>
                                    </div>
                                </div>
                                <div class="mx-auto my-2" id="no-shimmerApplications" style="display: none">
                                    <ul id="applicationsList" role="list" class="mt-6 grid grid-cols-1 gap-x-6 w-full gap-y-8 lg:grid-cols-2 xl:gap-x-8">
                                        <!-- Applications will be populated here -->
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const apiUrl = "https://ipo.gwcindia.in/v3/api-ipo-master.php"; 
        const applicationApiUrl = "https://ipo.gwcindia.in/v3/api-client-applications.php?clientCode=GZ10219";
        const companyList = [];
        
        function fetchCompanies() {
            fetch(apiUrl)
                .then((response) => response.json())
                .then((data) => {
                    console.log(data); 
                    data.upcoming;
                    
                    const companiesContainer = document.getElementById("companiesContainer");
                    companiesContainer.innerHTML = ""; 

                    if (Array.isArray(data.open)) {
                        data.open.forEach((company) => {
                            const companyDiv = document.createElement("li");
                            companyDiv.classList.add("overflow-hidden", "rounded-xl", "border", "border-gray-200", "py-2", "clickable-div");

                            companyDiv.addEventListener("click", function () {
                                sendDataToNewPage(company, "newipodetails.html"); // URL for IPO details
                            });

                            companyDiv.innerHTML = `
                                <div class="flex items-center gap-x-4 border-gray-900/5 py-2 px-3">
                                    <img src="https://tailwindui.com/plus/img/logos/48x48/tuple.svg" alt="${company.ipoName}" class="size-12 flex-none rounded-lg bg-white object-cover ring-1 ring-gray-900/10">
                                    <div>
                                        <div class="text-sm/6 font-medium text-gray-900">${company.ipoName}</div>
                                        <span class="rounded-sm bg-indigo-50 px-1 py-0.5 text-xs font-medium text-indigo-700 ring-1 ring-inset ring-indigo-600/10">MAINBOARD</span>
                                    </div>
                                </div>
                                <dl class="-my-3 divide-y divide-gray-100 px-3 py-4 text-sm/6">
                                    <div class="flex justify-between gap-x-4 py-3">
                                        <div>
                                            <dt class="text-gray-500">Closes on</dt>
                                            <dd class="text-gray-700 font-bold"><time datetime="${company.biddingEndDate}">${new Date(company.biddingEndDate).toLocaleDateString('en-GB', { day: '2-digit', month: 'short', year: 'numeric' })}</time></dd>
                                        </div>
                                        <div class="">
                                            <dt class="text-gray-500 flex justify-end">Minimum Investment</dt>
                                            <dd class="text-gray-700 font-bold flex items-center justify-end" id="maxInvestment">
                                                <time datetime="${company.biddingEndDate}">${calculateMaxInvestment(company.minPrice, company.lotSize)}</time>
                                                <span class="ml-2">/ ${company.minBidQuantity} shares</span>
                                            </dd>
                                        </div>
                                    </div>
                                    <div class="flex justify-between gap-x-4 p-3 rounded-md bg-gray-100">
                                        <dt class="text-gray-500"><span class="inline-flex items-center rounded-md bg-white px-1.5 py-0.5 text-xs font-medium text-gray-600">Day 1</span></dt>
                                        <dt>
                                            <div class="font-bold text-gray-900">Overall Subscription</div>
                                        </dt>
                                        <dd class="flex items-start gap-x-2">
                                            <div class="font-semibold text-green-600">0.71x</div>
                                        </dd>
                                    </div>
                                </dl>
                            `;
                            companiesContainer.appendChild(companyDiv);
                        });
                    } else {
                        console.error("The API response does not contain an array of open companies.");
                    }

                    // Handle Upcoming IPOs
                    if (Array.isArray(data.upcoming)) {
                        data.upcoming.forEach((company) => {
                            const companyDiv = document.createElement("li");
                            companyDiv.classList.add("overflow-hidden", "rounded-xl", "border", "border-gray-200", "py-2", "clickable-div");

                            // Attach the event listener to the companyDiv
                            companyDiv.addEventListener("click", function () {
                                sendDataToNewPage(company, "newipodetails.html"); // URL for IPO details
                            });

                            companyDiv.innerHTML = `
                                <div class="flex items-center gap-x-4 border-gray-900/5 py-2 px-3">
                                    <img src="https://tailwindui.com/plus/img/logos/48x48/tuple.svg" alt="${company.ipoName}" class="size-12 flex-none rounded-lg bg-white object-cover ring-1 ring-gray-900/10">
                                    <div>
                                        <div class="text-sm/6 font-medium text-gray-900">${company.ipoName}</div>
                                        <span class="rounded-md bg-indigo-50 px-2 py-1 text-xs font-medium text-indigo-700 ring-1 ring-inset ring-indigo-600/10">UPCOMING</span>
                                    </div>
                                </div>
                                <dl class="-my-3 divide-y divide-gray-100 px-3 py-4 text-sm/6">
                                    <div class="flex justify-between gap-x-4 py-3">
                                        <div>
                                            <dt class="text-gray-500">Bidding Starts</dt>
                                            <dd class="text-gray-700 font-bold"><time datetime="${company.biddingStartDate}">${new Date(company.biddingStartDate).toLocaleDateString()}</time></dd>
                                        </div>
                                        <div>
                                            <dt class="text-gray-500 flex justify-end">Min Price</dt>
                                            <dd class="text-gray-700 font-bold flex justify-end"><time datetime="${company.biddingEndDate}">${company.minPrice}</time></dd>
                                        </div>
                                    </div>
                                    <div class="flex justify-between gap-x-4 p-3 rounded-md bg-gray-100">
                                        <dt class="text-gray-500"><span class="inline-flex items-center rounded-md bg-white px-1.5 py-0.5 text-xs font-medium text-gray-600">Day 1</span></dt>
                                        <dt>
                                            <div class="font-bold text-gray-900">Overall Subscription</div>
                                        </dt>
                                        <dd class="flex items-start gap-x-2">
                                            <div class="font-semibold text-green-600">0.71x</div>
                                        </dd>
                                    </div>
                                </dl>
                            `;
                            companiesContainer.appendChild(companyDiv);
                        });
                    } else {
                        console.error("The API response does not contain an array of upcoming companies.");
                    }
                })
                .catch((error) => {
                    console.error("Error fetching companies:", error);
                });
        }

        fetchCompanies();

        const clientInfoUrl = "https://ipo.gwcindia.in/v3/api-client-info.php?clientCode=GZ10219"; 
        function fetchClientInfo() {
            fetch(clientInfoUrl)
                .then((response) => response.json())
                .then((data) => {
                    localStorage.setItem("clientInfo", JSON.stringify(data)); 
                    console.log("Client info stored in localStorage:", data);
                })
                .catch((error) => {
                    console.error("Error fetching client info:", error);
                });
        }

        function calculateMaxInvestment(maxPrice, lotSize) {
            const max = parseFloat(maxPrice) || 0;
            const lot = parseInt(lotSize) || 0;
            return `₹ ${(max * lot).toFixed(2)}`; 
        }

        fetchClientInfo();
        fetchApplications();
        window.onload = function () {
            setTimeout(() => {
                document.getElementById("shimmer").style.display = "none";
                document.getElementById("no-shimmer").style.display = "block";
            }, 2000);
        };

        function fetchApplications() {
            document.getElementById("shimmerApplications").style.display = "block";
            document.getElementById("no-shimmerApplications").style.display = "none";

            fetch(applicationApiUrl)
                .then((response) => {
                    if (!response.ok) {
                        throw new Error("Network response was not ok " + response.statusText);
                    }
                    return response.json();
                })
                .then((data) => {
                    console.log("Fetched data:", data); 
                    if (!data.applications) {
                        console.error("Applications property is missing in the response");
                        return;
                    }

                    const applicationsList = document.getElementById("applicationsList");
                    applicationsList.innerHTML = ""; 
                    if (Array.isArray(data.applications) && data.applications.length > 0) {
                        data.applications.forEach((application) => {
                            const applicationDiv = document.createElement("li");
                            applicationDiv.classList.add("overflow-hidden", "rounded-xl", "border", "border-gray-200", "py-2");

                            applicationDiv.addEventListener("click", function () {
                                sendDataToNewPage(application, "applicationdetailpage.html"); // URL for IPO details
                            });

                            applicationDiv.innerHTML = `
                                <div class="gap-x-4 border-gray-900/5 ">
                                    <div>
                                        <div class="flex items-center gap-x-4 border-gray-900/5 py-2 px-3">
                                            <img src="https://tailwindui.com/plus/img/logos/48x48/tuple.svg" alt="${application.ipoName}" class="size-12 flex-none rounded-lg bg-white object-cover ring-1 ring-gray-900/10">
                                            <div>
                                                <div class="text-sm/6 font-medium text-gray-900">${application.ipoName || "N/A"}</div>
                                                <span class="rounded-md bg-indigo-50 px-2 py-1 text-xs font-medium text-indigo-700 ring-1 ring-inset ring-indigo-600/10">MAINBOARD</span>
                                            </div>
                                        </div>
                                    </div>
                                    <dl class="-my-3 divide-y divide-gray-100 px-3 py-4 text-sm/6">
                                        <div class="flex justify-between gap-x-4 py-3">
                                            <div>
                                                <dt class="text-gray-500 flex justify-end">Invested</dt>
                                                <dd class="text-gray-700 font-bold flex justify-start px-1 ">₹${application.totalPrice || "N/A"}</dd>
                                            </div>
                                            <div>
                                                <dt class="text-gray-500 flex justify-end">Bit Price</dt>
                                                <dd class="text-gray-700 font-bold flex justify-start">₹${application.price || "N/A"}</dd>
                                            </div>
                                            <div>
                                                <dt class="text-gray-500 flex justify-end">Listed On</dt>
                                                <dd class="text-gray-700 font-bold"><time datetime="${application.requestedDateTime}">${new Date(application.requestedDateTime).toLocaleDateString('en-GB', { day: '2-digit', month: 'short', year: 'numeric' })}</time></dd>
                                            </div>
                                        </div>
                                        <div class="flex justify-between gap-x-4 p-3 rounded-md bg-gray-100">
                                            <dt class="text-gray-500"><span class="inline-flex items-center rounded-md bg-white px-1.5 py-0.5 text-xs font-medium text-gray-600">Day 1</span></dt>
                                            <dt>
                                                <div class="font-bold text-gray-900">Overall Subscription</div>
                                            </dt>
                                            <dd class="flex items-start gap-x-2">
                                                <div class="font-semibold text-green-600">0.71x</div>
                                            </dd>
                                        </div>
                                    </dl>
                                </div>
                            `;
                            applicationsList.appendChild(applicationDiv);
                        });
                    } else {
                        applicationsList.innerHTML = "<li>No applications found.</li>";
                    }

                    document.getElementById("shimmerApplications").style.display = "none";
                    document.getElementById("no-shimmerApplications").style.display = "block";
                })
                .catch((error) => {
                    console.error("Error fetching applications:", error);
                    document.getElementById("shimmerApplications").style.display = "none";
                    document.getElementById("no-shimmerApplications").style.display = "block";
                });
        }

        function sendDataToNewPage(company, url) {
            const queryParams = new URLSearchParams({
                name: company.ipoName || "",
                biddingStartDate: company.biddingStartDate || "",
                biddingEndDate: company.biddingEndDate || "",
                minPrice: company.minPrice !== undefined ? company.minPrice.toString() : "",
                maxPrice: company.maxPrice !== undefined ? company.maxPrice.toString() : company.price || "",
                cutOffPrice: company.cutOffPrice || "",
                lotSize: company.lotSize || company.qty || "",
                issueSize: company.issueSize || "",
                registrar: company.registrar || "",
                issueType: company.issueType || "",
                subType: company.subType || "",
                entryDate: company.entryDate || "",
                entryTime: company.entryTime || "",
                isin: company.isin || "",
                ipoSymbol: company.ipoSymbol || "",
                upiId: company.upiId || "",
                applicationNo: company.applicationNo || "",
            }).toString();

            window.location.href = `${url}?${queryParams}`;
        }
    </script>
</body>
</html>